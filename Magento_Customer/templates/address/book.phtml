<?php
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes. All rights reserved.
 * See COPYING.txt for license details.
 */

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\HeroiconsOutline;
use Magento\Customer\Block\Address\Book;
use Magento\Framework\Escaper;
use GardenLawn\Company\Helper\Data as CompanyHelper;

/** @var Book $block */
/** @var Escaper $escaper */
/** @var ViewModelRegistry $viewModels */

/** @var HeroiconsOutline $heroicons */
$heroicons = $viewModels->require(HeroiconsOutline::class);
$companyHelper = $viewModels->require(CompanyHelper::class);
$isB2bCustomer = in_array($companyHelper->getCurrentCustomerGroupId(), $companyHelper->getB2bCustomerGroups());
?>
<div class="block block-addresses-default my-6">
    <div class="block-title text-2xl mb-6">
            <?= $escaper->escapeHtml(__('Default Addresses')) ?>
    </div>
    <div class="grid-cols-2 block-content md:grid gap-x-4 gap-y-0 my-6">
        <?php if ($customerDefaultBillingAddressId = $block->getDefaultBilling()): ?>
            <div class="box box-address-billing card">
                <div class="text-gray-900 text-lg title-font font-medium mb-3">
                    <span><?= $escaper->escapeHtml(__('Default Billing Address')) ?></span>
                </div>
                <div class="box-content">
                    <address>
                        <?= $block->getAddressHtml($block->getAddressById($customerDefaultBillingAddressId)) ?>
                    </address>
                </div>
                <?php if (!$isB2bCustomer): ?>
                    <div class="box-actions">
                        <a href="<?= $escaper->escapeUrl($block->getAddressEditUrl($customerDefaultBillingAddressId)) ?>"
                           class="inline-flex items-center w-full mt-3 md:text-sm"
                           >
                            <span>
                                <?= $escaper->escapeHtml(__('Change Billing Address')) ?>
                            </span>
                            <?= $heroicons->arrowRightHtml('ml-2', 16, 16); ?>
                        </a>
                    </div>
                <?php endif; ?>
            </div>
        <?php else: ?>
            <div class="box box-billing-address card">
                <div class="text-gray-900 text-lg title-font font-medium mb-3">
                    <span>
                        <?= $escaper->escapeHtml(__('Default Billing Address')) ?>
                    </span>
                </div>
                <div class="box-content">
                    <p><?= $escaper->escapeHtml(__('You have no default billing address in your address book.')) ?></p>
                </div>
            </div>
        <?php endif ?>

        <?php if ($customerDefaultShippingAddressId = $block->getDefaultShipping()): ?>
            <div class="box box-address-shipping card">
                <div class="text-gray-900 text-lg title-font font-medium mb-3">
                    <span><?= $escaper->escapeHtml(__('Default Shipping Address')) ?></span>
                </div>
                <div class="box-content">
                    <address>
                        <?= $block->getAddressHtml($block->getAddressById($customerDefaultShippingAddressId)) ?>
                    </address>
                </div>
                <div class="box-actions">
                    <a href="<?= $escaper->escapeUrl($block->getAddressEditUrl($customerDefaultShippingAddressId)) ?>"
                       class="inline-flex items-center w-full mt-3 md:text-sm"
                       >
                        <span><?= $escaper->escapeHtml(__('Change Shipping Address')) ?></span>
                        <?= $heroicons->arrowRightHtml('ml-2', 16, 16); ?>
                    </a>
                </div>
            </div>
        <?php else: ?>
            <div class="box box-shipping-address card">
                <div class="text-gray-900 text-lg title-font font-medium mb-3">
                    <span>
                        <?= $escaper->escapeHtml(__('Default Shipping Address')) ?>
                    </span>
                </div>
                <div class="box-content">
                    <p>
                        <?= $escaper->escapeHtml(__('You have no default shipping address in your address book.')) ?>
                    </p>
                </div>
            </div>
        <?php endif ?>
    </div>
    <div class="actions-toolbar flex items-center gap-4">
        <div class="primary">
            <a href="<?= $escaper->escapeUrl($block->getAddressEditUrl()) ?>" class="btn btn-primary">
                <span><?= $escaper->escapeHtml(__('Add New Address')) ?></span>
            </a>
        </div>
        <div class="secondary">
            <a class="btn btn-secondary shrink-0"
               href="<?= $escaper->escapeUrl($block->getBackUrl()) ?>"
               x-data="{ clicked: false }"
               @click="clicked = true">
                <span x-show="!clicked"><?= $escaper->escapeHtml(__('Back')) ?></span>
                <span x-show="clicked" class="flex items-center gap-2" style="display: none;">
                    <svg class="animate-spin h-4 w-4 text-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <?= $escaper->escapeHtml(__('Back')) ?>
                </span>
            </a>
        </div>
    </div>
</div>
