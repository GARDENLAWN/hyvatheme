<?php
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes 2020-present. All rights reserved.
 * This product is licensed per Magento install
 * See https://hyva.io/license
 */

declare(strict_types=1);

use Hyva\Theme\ViewModel\HyvaCsp;
use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;

/** @var Escaper $escaper */
/** @var Template $block */
/** @var HyvaCsp $hyvaCsp */

// Remove any child blocks that don't need to be part of the footer columns
$footerColumns = array_diff(
    $block->getChildNames(),
    array('footer-copyright', 'form.subscribe', 'footer-content-before', 'footer-content-after')
);
?>

<?= $block->getChildHtml('footer-content-before') ?>
<?= $block->getChildHtml('subscribe') ?>
<div class="bg-white border-t border-gray-100">
    <div class="container py-12 mx-auto px-6">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 lg:gap-12 text-gray-600">
            <?php foreach ($footerColumns as $childName): ?>
                <?= $block->getBlockHtml($childName) ?>
            <?php endforeach; ?>
        </div>
    </div>
    <?php if ($footerContentAfter = $block->getChildHtml('footer-content-after')): ?>
        <div class="bg-gray-50 py-8 border-t border-gray-100">
            <div class="container mx-auto px-6 space-y-8">
                <?= /** @noEscape */ $footerContentAfter ?>
            </div>
        </div>
    <?php endif; ?>
    <div class="border-t border-gray-100 bg-white">
        <div class="container py-6 px-6 mx-auto flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-gray-500">
            <?= $block->getChildHtml('copyright') ?>
            <nav class="flex flex-wrap justify-center gap-6" aria-label="<?= $escaper->escapeHtml(__('Legal Menu')) ?>">
                <a
                    href="<?= $escaper->escapeUrl($block->getUrl('regulamin')) ?>"
                    class="hover:text-primary transition-colors"
                ><?= $escaper->escapeHtml(__('Terms & Conditions')) ?></a>
                <a
                    href="<?= $escaper->escapeUrl($block->getUrl('polityka-prywatnosci')) ?>"
                    class="hover:text-primary transition-colors"
                ><?= $escaper->escapeHtml(__('Privacy Policy')) ?></a>
            </nav>
        </div>
    </div>
</div>
<script>
    function mobileFooterCollpase() {
        return {
            open: false,
            isMobile: false,
            init() {
                this.checkIsMobileResolution();
                if (this.$root.dataset.open === "true") {
                    this.open = true;
                }
            },
            checkIsMobileResolution() {
                this.isMobile = getComputedStyle(this.$refs.toggleIcon).display !== 'none'
            },
            isOpen() {
                return this.isMobile ? this.open : true;
            },
            toggle() {
                return this.isMobile ? this.open = !this.open : true;
            },
            eventListeners: {
                ['@resize.window.debounce']() {
                    this.checkIsMobileResolution();
                },
                ['@visibilitychange.window.debounce']() {
                    this.checkIsMobileResolution();
                }
            },
            setToggleRoles: {
                [':role']() {
                    return this.isMobile && 'button';
                },
                [':tabindex']() {
                    return this.isMobile && '0';
                },
                [':aria-expanded']() {
                    return this.isMobile ? this.open : null;
                },
                [':aria-controls']() {
                    return this.isMobile ? this.$el.dataset.id : null;
                }
            },
            setCollapseRoles: {
                [':aria-hidden']() {
                    return this.isMobile ? !this.open : null;
                },
                [':aria-labelledby']() {
                    return this.isMobile ? this.$el.id : null;
                }
            }
        }
    }
    window.addEventListener('alpine:init', () => Alpine.data('mobileFooterCollpase', mobileFooterCollpase), { once: true })
</script>
<?php $hyvaCsp->registerInlineScript() ?>
