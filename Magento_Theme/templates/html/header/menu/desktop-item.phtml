<?php
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes 2020-present. All rights reserved.
 * This product is licensed per Magento install
 * See https://hyva.io/license
 */

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\HeroiconsSolid;
use Magento\Framework\View\Element\Template;
use Magento\Framework\Escaper;

/** @var Template $block */
/** @var Escaper $escaper */
/** @var ViewModelRegistry $viewModels */

/** @var HeroiconsSolid $heroiconsSolid */
$heroiconsSolid = $viewModels->require(HeroiconsSolid::class);

/** @var string[] $menu */
$item = $block->getData('item');
$level = $block->getData('level');
$menuId = str_replace('-', '_',$item['id']);
?>

<?php if (!empty($item['childData'])): ?>
    <li
        class="level-<?= $level ?> relative group/subitem"
        data-id="<?= /* @noEscape */$menuId ?>"
        x-data="initSubMenuDesktopItem"
        @click.outside="close"
        @mouseenter="canHoverOpen"
        @mouseleave="canHoverClose"
    >
        <button
            type="button"
            class="group w-full flex justify-between items-center gap-2 p-2.5 rounded-xl text-sm font-medium text-gray-600 transition-all duration-200
                hover:bg-gray-50 hover:text-primary hover:pl-3.5
                aria-expanded:bg-primary-50 aria-expanded:text-primary aria-expanded:font-bold
                data-[has-current]:font-bold data-[has-current]:text-primary"
            x-ref="childmenuToggle"
            @click="toggle"
            aria-expanded="false"
            :aria-expanded="open"
            aria-controls="<?= $escaper->escapeHtml($item['id']) ?>-desktop-menu-panel"
        >
            <span class="truncate"><?= $escaper->escapeHtml($item['name']) ?></span>
            <?= $heroiconsSolid->chevronRightHtml(
                'w-4 h-4 text-gray-300 group-hover:text-primary group-aria-expanded:text-primary transition-colors',
                16,
                16,
                ['aria-hidden' => 'true'])
            ?>
        </button>
        <ul
            id="<?= $escaper->escapeHtml($item['id']) ?>-desktop-menu-panel"
            class="absolute top-0 left-full ml-2 min-w-[220px] bg-white rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.15)] ring-1 ring-black/5 flex flex-col gap-1 p-2 z-40"
            x-show="open"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 translate-x-2 scale-95"
            x-transition:enter-end="opacity-100 translate-x-0 scale-100"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 translate-x-0 scale-100"
            x-transition:leave-end="opacity-0 translate-x-2 scale-95"
            x-ref="childmenuWrapper"
            @keydown.escape.stop="close"
            x-cloak
        >
            <li class="mb-1 pb-1 border-b border-gray-100">
                <a
                    href="<?= $escaper->escapeUrl($item['url']) ?>"
                    class="group/link flex items-center justify-between p-2.5 rounded-xl text-sm font-bold text-gray-900 hover:bg-primary/5 hover:text-primary transition-all duration-200"
                    x-ref="childmenuViewAll"
                >
                    <?= $escaper->escapeHtml(__('All %1', $item['name'])) ?>
                    <span class="bg-gray-100 text-gray-400 rounded-full p-1 group-hover/link:bg-primary group-hover/link:text-white transition-all duration-200">
                        <?= $heroiconsSolid->arrowRightHtml('w-3 h-3', 12, 12, ['aria-hidden' => 'true']) ?>
                    </span>
                </a>
            </li>
            <?php foreach ($item['childData'] as $subMenu): ?>
                <?= $block->getLayout()->getBlock('topmenu_desktop_item')
                    ->setItem($subMenu)
                    ->setLevel($level + 1)
                    ->toHtml() ?>
            <?php endforeach; ?>
        </ul>
    </li>
<?php else: ?>
    <li class="level-<?= $level ?>">
        <a
            href="<?= $escaper->escapeUrl($item['url']) ?>"
            class="level-<?= $level ?> block p-2.5 rounded-xl text-sm font-medium text-gray-600 transition-all duration-200
                hover:bg-gray-50 hover:text-primary hover:pl-3.5
                aria-[current=page]:font-bold aria-[current=page]:text-primary aria-[current=page]:bg-primary-50"
        ><?= $escaper->escapeHtml($item['name']) ?></a>
    </li>
<?php endif; ?>
