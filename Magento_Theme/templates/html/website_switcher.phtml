<?php
/**
 * @var Template $block
 * @var Escaper $escaper
 */

use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;

$websiteSwitcher = $block->getData('view_model');

try {
    $websites = $websiteSwitcher->getAvailableWebsites();
    $currentWebsite = $websiteSwitcher->getCurrentWebsite();

    if (count($websites) <= 1) {
        return;
    }
} catch (Exception $e) {
    return;
}
//echo "Aktualna domyślna strefa czasowa PHP: <strong>" . date_default_timezone_get() . "</strong><br>";
//echo "Czas wg PHP (używając tej strefy): <strong>" . date('Y-m-d H:i:s T') . "</strong><br>";
//phpinfo();
?>

<div class="website-switcher-container border-b border-gray-200 bg-gray-50 py-2" x-data="gardenLawnHyvathemeHtmlWebsiteSwitcher">
    <div class="container mx-auto px-4">
        <div class="flex w-full">

            <!-- Mobile Dropdown -->
            <div class="relative lg:hidden">
                <button @click="gardenLawnHyvathemeHtmlWebsiteSwitcherClick1"
                        class="flex items-center gap-2 rounded-md border border-gray-300 bg-white px-3 py-2 text-sm hover:bg-gray-50"
                        :aria-expanded="open">
                    <span><?= $escaper->escapeHtml($currentWebsite->getName()) ?></span>
                    <svg class="h-4 w-4 transition-transform" :class="gardenLawnHyvathemeHtmlWebsiteSwitcherClass2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>

                <div x-show="open"
                     @click.away="gardenLawnHyvathemeHtmlWebsiteSwitcherClickAway3"
                     x-transition
                     class="absolute right-0 z-50 mt-2 w-48 rounded-md border border-gray-200 bg-white shadow-lg">
                    <?php foreach ($websites as $website): ?>
                        <?php if ($website->getId() == $currentWebsite->getId()): ?>
                            <div class="cursor-default bg-primary-50 px-4 py-2 text-sm font-semibold text-primary-700">
                                <?= $escaper->escapeHtml($website->getName()) ?>
                            </div>
                        <?php else: ?>
                            <a href="<?= $escaper->escapeUrl($websiteSwitcher->getWebsiteUrl($website)) ?>"
                               class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <?= $escaper->escapeHtml($website->getName()) ?>
                            </a>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
            </div>

            <!-- Desktop Buttons -->
            <div class="hidden lg:flex w-full items-stretch gap-2" id="website-switcher" aria-label="<?= $escaper->escapeHtml(__('Switch website')) ?>">
                <?php foreach ($websites as $website): ?>
                    <?php if ($website->getId() == $currentWebsite->getId()): ?>
                        <span class="flex-1 basis-0 min-w-0 inline-flex justify-center items-center rounded-md border border-primary-600 bg-primary-50 px-3 py-2 text-sm font-semibold text-primary-700 cursor-default truncate" title="<?= $escaper->escapeHtmlAttr($website->getName()) ?>">
                            <?= $escaper->escapeHtml($website->getName()) ?>
                        </span>
                    <?php else: ?>
                        <a href="<?= $escaper->escapeUrl($websiteSwitcher->getWebsiteUrl($website)) ?>"
                           class="flex-1 basis-0 min-w-0 inline-flex justify-center items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 truncate"
                           title="<?= $escaper->escapeHtmlAttr($website->getName()) ?>">
                            <?= $escaper->escapeHtml($website->getName()) ?>
                        </a>
                    <?php endif; ?>
                <?php endforeach; ?>
            </div>
        </div>
    </div>
</div>
<script>
<?php /** Generated with hyva-csp-helper.php */ ?>
function gardenLawnHyvathemeHtmlWebsiteSwitcher() {
    return Object.assign(
        { open: false }
        ,{
            ['gardenLawnHyvathemeHtmlWebsiteSwitcherClass2']() {return { 'rotate-180': this.open }},
            ['gardenLawnHyvathemeHtmlWebsiteSwitcherClick1'](event) {return this.open = !this.open},
            ['gardenLawnHyvathemeHtmlWebsiteSwitcherClickAway3'](event) {return this.open = false},
        }
    )
}
window.addEventListener('alpine:init', () => Alpine.data('gardenLawnHyvathemeHtmlWebsiteSwitcher', gardenLawnHyvathemeHtmlWebsiteSwitcher), {once: true});
</script>
<?php $hyvaCsp->registerInlineScript() ?>
