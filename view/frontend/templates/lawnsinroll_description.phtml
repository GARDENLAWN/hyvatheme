<?php declare(strict_types=1);

/** @var Template $block */
/** @var Escaper $escaper */
/** @var ViewModelRegistry $viewModels */

/** @var Slider $sliderViewModel */

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\Slider;
use Magento\Catalog\Block\Product\View;
use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;

/** @var View $block */
$product = $block->getProduct();
$sliderViewModel = $viewModels->require(Slider::class);
$itemsVideoTemplate = 'GardenLawn_Core::slider-youtube-item.phtml';
$itemsVideo = [
    ['divId' => 'video1', 'videoId' => 'ZW0THAI6G7I'],
    ['divId' => 'video2', 'videoId' => 'cBsLcsb8PRg'],
    ['divId' => 'video3', 'videoId' => 'PVDK3esEKr8'],
    ['divId' => 'video4', 'videoId' => 'ryt9oYCqWIs']
];

$product = $block->getProduct();
?>
<style type="text/css">
    iframe {
        overflow: hidden !important;
        -ms-overflow-style: none !important; /* IE and Edge */
        scrollbar-width: none !important; /* Firefox */
        width: 100%;
    }

    iframe::-webkit-scrollbar {
        display: none !important;
        background-color: transparent !important;
    }

    iframe::-webkit-scrollbar {
        width: 0px !important;
        height: 0px !important;
        background-color: transparent !important;
    }

    iframe::-webkit-scrollbar-button {
        width: 0px !important;
        height: 0px !important;
        background-color: transparent !important;
    }

    iframe::-webkit-scrollbar-thumb {
        background-color: transparent !important;
        border: 0px none !important;
        border-radius: 0px !important;
    }

    iframe::-webkit-scrollbar-thumb:hover {
        background-color: transparent !important;
    }

    iframe::-webkit-scrollbar-thumb:active {
        background-color: transparent !important;
    }

    iframe::-webkit-scrollbar-track {
        background-color: transparent !important;
        border: 0px none !important;
        border-radius: 0px !important;
    }

    iframe::-webkit-scrollbar-track:hover {
        background-color: transparent !important;
    }

    iframe::-webkit-scrollbar-track:active {
        background-color: transparent !important;
    }

    iframe::-webkit-scrollbar-corner {
        background-color: transparent !important;
    }

    .topnav a {
        text-align: center;
    }

    .tabs-container {
        padding: 0;
        margin-left: -23px;
    }

    @media (max-width: 768px) {
        .tabs-container {
            margin-left: 0;
            width: 100%;
        }
    }
</style>

<section>
    <?= $block->getChildHtml('product_options_wrapper_bottom') ?>
</section>


<div id="tabs-description">
    <div class="tabs-container" data-content-type="tabs" data-appearance="default" data-active-tab=""
         data-element="main">
        <ul role="tablist" style=" text-align: center;" class="tabs-navigation" data-element="navigation">
            <li role="tab" class="tab-header active" data-element="headers"><a href="#tab_1" class="tab-title"><span
                        class="tab-title">Trawa z Rolki</span></a></li>
            <li role="tab" class="tab-header" data-element="headers"><a href="#tab_2" class="tab-title"
                                                                        onclick="loadIframe(this)"><span
                        class="tab-title">O Producencie</span></a></li>
            <li role="tab" class="tab-header" data-element="headers"><a href="#tab_3" class="tab-title"
                                                                        onclick="loadIframe(this)"><span
                        class="tab-title">Pielęgnacja Trawnika</span></a></li>
            <li role="tab" class="tab-header" data-element="headers"><a href="#tab_4" class="tab-title"
                                                                        onclick="loadIframe(this)"><span
                        class="tab-title">Zakładanie Trawnika</span></a></li>
            <li role="tab" class="tab-header" data-element="headers"><a href="#tab_5" class="tab-title"
                                                                        onclick="loadIframe(this)"><span
                        class="tab-title">Logistyka</span></a></li>
        </ul>
        <div id="tab-content" class="tabs-content" data-element="content" style="width: 100%;">
            <div data-content-type="tab-item" data-appearance="default" data-tab-name="Trawa z Rolki"
                 data-background-images="{}"
                 data-element="main" id="tab_1" style="padding: 0">
                <iframe id="iframe_1" style="width: 100%; overflow:hidden;" frameborder="0" scrolling="no"
                        onload="resizeIframe(this)"
                        src="/hyvaroot/pages/grassinfo1"></iframe>
            </div>
            <div data-content-type="tab-item" data-appearance="default" data-tab-name="O Producencie"
                 data-background-images="{}"
                 data-element="main" id="tab_2" style="padding: 0">
                <iframe id="iframe_2" style="width: 100%; overflow:hidden;" frameborder="0" scrolling="no"
                        src=""></iframe>
            </div>
            <div data-content-type="tab-item" data-appearance="default" data-tab-name="Pielęgnacja Trawnika"
                 data-background-images="{}"
                 data-element="main" id="tab_3" style="padding: 0">
                <iframe id="iframe_3" style="width: 100%; overflow:hidden;" frameborder="0" scrolling="no"
                        src=""></iframe>
            </div>
            <div data-content-type="tab-item" data-appearance="default" data-tab-name="Zakładanie Trawnika"
                 data-background-images="{}"
                 data-element="main" id="tab_4" style="padding: 0">
                <iframe id="iframe_4" style="width: 100%; overflow:hidden;" frameborder="0" scrolling="no"
                        src=""></iframe>
            </div>
            <div data-content-type="tab-item" data-appearance="default" data-tab-name="Logistyka"
                 data-background-images="{}"
                 data-element="main" id="tab_5" style="padding: 0">
                <iframe id="iframe_5" style="width: 100%; overflow:hidden;" frameborder="0" scrolling="no"
                        src=""></iframe>
            </div>
        </div>
    </div>
</div>
<script>
    function resizeIframe(obj) {
        if (!obj || !obj.contentWindow) return;

        try {
            const doc = obj.contentWindow.document;
            const body = doc.body;
            const html = doc.documentElement;

            // Reset height to allow shrinking
            obj.style.height = 'auto';

            const height = Math.max(
                body.scrollHeight, body.offsetHeight,
                html.clientHeight, html.scrollHeight, html.offsetHeight
            );

            obj.style.height = height + 'px';
            obj.style.width = '100%';
            obj.style.overflow = 'hidden';
            obj.style.overflowY = 'hidden';

            body.style.textAlign = "<?= GardenLawn\Core\Utils\Utils::isFirefox() ? '-moz-center' : '-webkit-center' ?>";
            body.style.margin = "0 auto";
        } catch (e) {
            console.warn('Cannot resize iframe', e);
        }
    }

    function loadIframe(tab) {
        let id = tab.href.substr(tab.href.length - 1);
        let iframe = document.getElementById('iframe_' + id);
        if (iframe.isinit === undefined) {
            iframe.isinit = false;
            iframe.src = '/hyvaroot/pages/grassinfo' + id;
            iframe.onload = function () {
                resizeIframe(iframe);
                try {
                    iframe.contentWindow.document.getElementById('am-cookie-bar').remove();
                } catch (ex) {

                }
            };
        } else {
            resizeIframe(iframe);
        }
    }

    window.addEventListener('resize', function() {
        document.querySelectorAll('iframe[id^="iframe_"]').forEach(function(iframe) {
            if (iframe.contentWindow && iframe.src) {
                resizeIframe(iframe);
            }
        });
    });
</script>
